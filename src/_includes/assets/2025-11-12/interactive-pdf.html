<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive PDF Explainer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the PDF "canvas" */
        #pdf-canvas {
            position: relative;
            background-image: linear-gradient(to right, #e5e7eb 1px, transparent 1px), linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden;
        }
        #pdf-text-output {
            position: absolute;
            font-family: 'Times New Roman', Times, serif; /* Mimic a common PDF font */
            /* transform: scaleY(-1); */ /* PDF coordinates are bottom-left, HTML is top-left - REMOVED */
            /* transform-origin: bottom left; */ /* REMOVED */
            white-space: pre;
        }
        /* Style for clickable code */
        .code-link {
            cursor: pointer;
            text-decoration: underline;
            color: #60a5fa; /* blue-400 */
        }
        .code-link:hover {
            color: #2563eb; /* blue-600 */
        }
        /* Simple modal for explanations */
        #explanation-modal {
            transition: opacity 0.2s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 leading-relaxed">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-3xl font-bold text-gray-800">How Does a PDF *Actually* Work?</h1>
            <p class="text-lg text-gray-600">An Interactive Explainer</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Explanations -->
        <div class="lg:col-span-2 space-y-8">

            <!-- Introduction -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-3">It's Not Just a "Digital Paper"</h2>
                <p class="mb-4">You probably think of a PDF as a static document, like a digital piece of paper or an image. But it's much more complex and powerful than that.</p>
                <p class="mb-4">A PDF is a <strong class="text-blue-600">database of objects</strong> and a set of <strong class="text-blue-600">drawing instructions</strong>. It's a programming language for describing a page. It tells the PDF reader (like Acrobat) *exactly* where to place every character, line, and image.</p>
                <p>Let's break down the main components.</p>
            </div>

            <!-- Section 1: The Building Blocks (Objects) -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-3">Section 1: The Building Blocks (Objects)</h2>
                <p class="mb-4">A PDF file is structured around "objects." An object is just a piece of data. There are a few main types. Click to see examples:</p>
                
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="obj-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg" data-type="string">String</button>
                    <button class="obj-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg" data-type="name">Name</button>
                    <button class="obj-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg" data-type="array">Array</button>
                    <button class="obj-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg" data-type="dict">Dictionary</button>
                </div>

                <div id="obj-explainer" class="bg-gray-50 p-4 rounded-md border border-gray-200 min-h-[100px]">
                    <p class="text-gray-500">Click a button above to learn about an object type.</p>
                </div>
            </div>

            <!-- Section 2: The File Structure -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-3">Section 2: The File Structure (Abridged)</h2>
                <p class="mb-4">A PDF file has four main parts. Click on the <span class="code-link">blue text</span> in the example below to see what each part does.</p>
                
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
<span class="code-link" data-title="Header" data-info="This is the 'magic number' that tells your computer, 'This is a PDF file!' It also specifies the version of the PDF standard it follows."><b>%PDF-1.7</b></span>
%... binary characters ...

<span class="code-link" data-title="Body (Object 1: The Page)" data-info="This is the 'body' of the PDF, containing all the objects. This first object is a 'Page' dictionary. It defines the page size (MediaBox) and points to its parent (the main page tree) and its content stream (the drawing instructions)."><b>1 0 obj</b>
  &lt;&lt; /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 612 792]
     /Contents 3 0 R
     <span class="text-green-400">/Resources &lt;&lt; /XObject &lt;&lt; /Img1 4 0 R >> >></span>
  &gt;&gt;
<b>endobj</b></span>

<span class="code-link" data-title="Body (Object 3: The Content Stream)" data-info="This object holds the *actual drawing instructions* for the page. The 'stream' contains the text and graphics commands. We'll look at this in the next section."><b>3 0 obj</b>
  &lt;&lt; /Length 44 &gt;&gt;
<b>stream</b>
  BT
  /F1 12 Tf
  72 700 Td
  (Hello, PDF!) Tj
  ET
<b>endstream</b>
<b>endobj</b></span>

<span class="code-link" data-title="Body (Object 4: The Image)" data-info="This is an Image XObject (External Object). It's a dictionary describing the image: its size, color space, and compression filter (like /DCTDecode for JPEGs). The actual compressed image data is in the stream. The page refers to this object by the name '/Img1'."><b>4 0 obj</b>
  &lt;&lt; /Type /XObject
     /Subtype /Image
     /Width 200
     /Height 150
     /ColorSpace /DeviceRGB
     /BitsPerComponent 8
     /Filter /DCTDecode
     /Length 12345
  &gt;&gt;
<b>stream</b>
  % ... actual compressed JPEG data ...
<b>endstream</b>
<b>endobj</b></span>

<span class="code-link" data-title="Cross-Reference (xref) Table" data-info="This is the most crucial part for a reader. It's a 'table of contents' that tells the program the *exact byte location* of every object in the file. This is why PDFs open so fastâ€”they don't need to read the whole file, just the xref table."><b>xref</b>
0 5
0000000000 65535 f
0000000018 00000 n
0000000000 65535 f
0000000115 00000 n
0000000200 00000 n</span>

<span class="code-link" data-title="Trailer" data-info="The trailer tells the reader where to find the 'xref' table (at byte 230 in this case) and which object is the 'Root' of the document (the main catalog, not shown here for simplicity). It's the very last thing in the file."><b>trailer</b>
&lt;&lt; /Size 5 /Root 1 0 R &gt;&gt;
<b>startxref</b>
230
<b>%%EOF</b></span>
                </pre>
            </div>

            <!-- Section 3: The "Drawing" Instructions -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-3">Section 3: The "Drawing" Instructions</h2>
                <p class="mb-4">This is the fun part. A PDF doesn't store "Hello World" as you see it. It stores *instructions* on how to draw it. The text below is a "Content Stream" (like object 3 from above).</p>
                <p class="mb-2">Edit the commands and click <strong>Run Instructions</strong> to see what happens on the "page" to the right!</p>
                
                <textarea id="pdf-code" class="w-full h-64 p-2 font-mono text-sm bg-gray-900 text-green-400 rounded-md border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
q
% q: Save graphics state

200 0 0 150 100 550 cm
% cm: Set transformation matrix
% (scale 200w, 150h; position at x:100, y:550)

/Img1 Do
% Do: Draw the image named /Img1

Q
% Q: Restore graphics state

BT
% Begin Text block

/F1 12 Tf
% Set Font 'F1' to 12 points

72 500 Td
% Move to position (x:72, y:500)
% (below the image)

(Hello, PDF! Images are objects too.) Tj
% Show the text

ET
% End Text block
</textarea>
                <button id="run-btn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full">
                    Run Instructions
                </button>
            </div>

        </div> <!-- End Left Column -->

        <!-- Right Column: Interactive Demos -->
        <div class="lg:col-span-1 space-y-8">
            
            <!-- PDF Page Simulation -->
            <div class="sticky top-8">
                <h3 class="text-xl font-semibold mb-2">Simulated PDF Page (8.5" x 11")</h3>
                <div class="aspect-[8.5/11] w-full bg-white rounded-lg shadow-xl border-4 border-gray-300">
                    <!-- This is the "canvas" our JS will draw on -->
                    <div id="pdf-canvas" class="w-full h-full rounded-sm">
                        <!-- Text will be injected here by JS -->
                    </div>
                </div>
                <div class="mt-4 p-4 bg-gray-800 text-white rounded-lg shadow-md">
                    <h4 class="font-bold mb-2">Command Log:</h4>
                    <div id="command-log" class="font-mono text-sm h-32 overflow-y-auto text-green-400">
                        Click "Run Instructions" to see the log...
                    </div>
                </div>
            </div>

        </div> <!-- End Right Column -->

    </main>

    <!-- Modal for explanations -->
    <div id="explanation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full transform scale-95 transition-transform">
            <h3 id="modal-title" class="text-2xl font-semibold mb-3">Modal Title</h3>
            <p id="modal-info" class="text-lg text-gray-700"></p>
            <button id="modal-close-btn" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                Got it
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Section 1: Object Explainer ---
            const objBtns = document.querySelectorAll('.obj-btn');
            const objExplainer = document.getElementById('obj-explainer');
            
            const objData = {
                string: {
                    code: `(This is a literal string)
<90AB01FF> % This is a hex string`,
                    desc: "A <strong>String</strong> holds text. It's usually enclosed in parentheses <code>()</code>. It can also be stored as hexadecimal code in angle brackets <code><></code>."
                },
                name: {
                    code: `/Type
/Page
/MediaBox`,
                    desc: "A <strong>Name</strong> is a unique label or key, like a variable name. It always starts with a forward slash <code>/</code>. They are fundamental to PDF's key-value structure."
                },
                array: {
                    code: `[ 0 0 612 792 ]
[ /PDF /Text /ImageC ]`,
                    desc: "An <strong>Array</strong> is an ordered list of other objects, enclosed in square brackets <code>[]</code>. This is often used to define things like a page's boundaries (the <code>MediaBox</code>) or a list of resource types."
                },
                dict: {
                    code: `<< /Type /Page
   /MediaBox [0 0 612 792]
   /Contents 3 0 R
>>`,
                    desc: "A <strong>Dictionary</strong> is the most important object. It's a collection of key-value pairs, enclosed in double angle brackets <code><< >></code>. The key is always a <strong>Name</strong> object (e.g., <code>/Type</code>). This is how everything in a PDF is described, from a page to a font."
                }
            };

            objBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const type = btn.dataset.type;
                    objExplainer.innerHTML = `
                        <pre class="bg-gray-800 text-white p-3 rounded-md overflow-x-auto mb-3">${objData[type].code}</pre>
                        <p class="text-gray-800">${objData[type].desc}</p>
                    `;
                    // Highlight active button
                    objBtns.forEach(b => b.classList.replace('bg-blue-500', 'bg-gray-200'));
                    btn.classList.replace('bg-gray-200', 'bg-blue-500');
                    btn.classList.add('text-white');
                });
            });

            // --- Section 2: File Structure Modal ---
            const codeLinks = document.querySelectorAll('.code-link');
            const modal = document.getElementById('explanation-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalInfo = document.getElementById('modal-info');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            codeLinks.forEach(link => {
                link.addEventListener('click', () => {
                    modalTitle.textContent = link.dataset.title;
                    modalInfo.innerHTML = link.dataset.info;
                    modal.classList.remove('opacity-0', 'pointer-events-none');
                    modal.querySelector('div').classList.remove('scale-95');
                });
            });

            const closeModal = () => {
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.querySelector('div').classList.add('scale-95');
            };

            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // --- Section 3: Interactive Page Content ---
            const runBtn = document.getElementById('run-btn');
            const codeInput = document.getElementById('pdf-code');
            const canvas = document.getElementById('pdf-canvas');
            const log = document.getElementById('command-log');

            runBtn.addEventListener('click', () => {
                // Clear previous run
                canvas.innerHTML = '';
                log.innerHTML = '';

                const lines = codeInput.value.split('\n');
                
                let graphicsState = {
                    font: '12px',
                    textMatrix: [1, 0, 0, 1, 0, 0], // For Td
                    currentMatrix: null // For cm
                };
                let stateStack = [];
                let inTextObject = false;

                // Dimensions of a US Letter page in points (612x792)
                const pageHeight = 792;
                
                // Canvas dimensions (for scaling)
                const canvasHeight = canvas.clientHeight;
                const canvasWidth = canvas.clientWidth;
                
                // PDF y-coords are from bottom, HTML y-coords are from top.
                // We need to flip them.
                const scale = canvasHeight / pageHeight;

                lines.forEach((line, index) => {
                    // Trim whitespace and comments
                    let command = line.split('%')[0].trim();
                    if (!command) {
                        if (line.trim().startsWith('%')) {
                            logMessage(`Comment: ${line.trim().substring(1)}`, 'gray');
                        }
                        return; // Skip empty lines or full-line comments
                    }

                    const parts = command.split(' ');
                    const operator = parts.pop();

                    switch (operator) {
                        case 'q':
                            stateStack.push(JSON.parse(JSON.stringify(graphicsState)));
                            logMessage('q: Save Graphics State', 'blue');
                            break;
                        case 'Q':
                            if (stateStack.length > 0) {
                                graphicsState = stateStack.pop();
                                logMessage('Q: Restore Graphics State', 'blue');
                            } else {
                                logMessage('Error: Unmatched Q', 'red');
                            }
                            break;
                        case 'BT':
                            inTextObject = true;
                            graphicsState.textMatrix = [1, 0, 0, 1, 0, 0]; // Reset text matrix
                            logMessage('BT: Begin Text Block', 'blue');
                            break;
                        case 'ET':
                            inTextObject = false;
                            logMessage('ET: End Text Block', 'blue');
                            break;
                        case 'Tf':
                            const fontSize = parts.pop();
                            const fontName = parts.join(' ');
                            graphicsState.font = `${fontSize}px`;
                            logMessage(`Tf: Set Font ${fontName} to ${fontSize}pt`, 'green');
                            break;
                        case 'Td':
                            const y = parseFloat(parts.pop());
                            const x = parseFloat(parts.pop());
                            graphicsState.textMatrix = [1, 0, 0, 1, x, y];
                            logMessage(`Td: Move to (x:${x}, y:${y})`, 'green');
                            break;
                        case 'Tj':
                            if (inTextObject) {
                                const text = command.substring(command.indexOf('(') + 1, command.lastIndexOf(')'));
                                logMessage(`Tj: Show Text "${text}"`, 'yellow');
                                
                                // Create and position the text element
                                const textEl = document.createElement('div');
                                textEl.id = 'pdf-text-output';
                                textEl.textContent = text;
                                
                                // Get position from text matrix
                                const currentX = graphicsState.textMatrix[4];
                                const currentY = graphicsState.textMatrix[5];

                                // Scale positions to fit our canvas
                                const scaledX = currentX * scale;
                                
                                // Calculate 'top' position for HTML
                                // (pageHeight - currentY) gives the Y-coord from the top in PDF points
                                // Then we scale it to the canvas size
                                const htmlTop = (pageHeight - currentY) * scale;
                                const scaledFontSize = parseFloat(graphicsState.font) * scale;

                                textEl.style.fontSize = `${scaledFontSize}px`;
                                textEl.style.left = `${scaledX}px`;
                                // PDF's (x,y) is the bottom-left of the text.
                                // HTML's (left,top) is the top-left of the div.
                                // We subtract font size to align the baselines correctly.
                                textEl.style.top = `${htmlTop - scaledFontSize}px`; 
                                
                                canvas.appendChild(textEl);
                            } else {
                                logMessage('Error: Tj operator outside BT/ET block', 'red');
                            }
                            break;
                        case 'cm':
                            const matrix = parts.map(parseFloat);
                            if (matrix.length === 6) {
                                graphicsState.currentMatrix = matrix;
                                logMessage(`cm: Set Matrix [${matrix.join(' ')}]`, 'green');
                            } else {
                                logMessage(`Error: Invalid cm operator`, 'red');
                            }
                            break;
                        case 'Do':
                            const imageName = parts.join(' ');
                            logMessage(`Do: Draw Object ${imageName}`, 'yellow');
                            
                            if (graphicsState.currentMatrix) {
                                const [a, b, c, d, e, f] = graphicsState.currentMatrix;
                                
                                const imgPlaceholder = document.createElement('div');
                                imgPlaceholder.textContent = `Image Placeholder (${imageName})`;
                                imgPlaceholder.style.cssText = `
                                    position: absolute;
                                    border: 2px dashed #9ca3af;
                                    background: rgba(156, 163, 175, 0.1);
                                    color: #6b7280;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-family: 'Inter', sans-serif;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                `;
                                
                                const width = a * scale;
                                const height = d * scale;
                                const x = e * scale;
                                const y_pdf = f; // PDF y-coord
                                
                                // HTML top is calculated from PDF's bottom-left y
                                const htmlTop = (pageHeight - y_pdf) * scale - height;
                                
                                imgPlaceholder.style.width = `${width}px`;
                                imgPlaceholder.style.height = `${height}px`;
                                imgPlaceholder.style.left = `${x}px`;
                                imgPlaceholder.style.top = `${htmlTop}px`;
                                
                                canvas.appendChild(imgPlaceholder);
                            } else {
                                logMessage('Error: "Do" without preceding "cm" matrix', 'red');
                            }
                            break;
                        default:
                            logMessage(`Unknown op: ${command}`, 'gray');
                    }
                });
            });

            function logMessage(message, color) {
                const colors = {
                    'blue': 'text-blue-400',
                    'green': 'text-green-400',
                    'yellow': 'text-yellow-400',
                    'red': 'text-red-500',
                    'gray': 'text-gray-500'
                };
                log.innerHTML += `<span class="${colors[color] || 'text-white'} block">&gt; ${message}</span><br/>`;
                log.scrollTop = log.scrollHeight; // Auto-scroll
            }
            
            // Initial run to show something
            runBtn.click();
        });
    </script>

</body>
</html>
